{"ast":null,"code":"const express = require('express');\n\nconst router = express.Router();\n\nconst User = require('../models/user');\n\nconst passport = require('../passport');\n\nrouter.post('/', (req, res) => {\n  console.log('user signup');\n  const _req$body = req.body,\n        username = _req$body.username,\n        password = _req$body.password; // ADD VALIDATION\n\n  User.findOne({\n    username: username\n  }, (err, user) => {\n    if (err) {\n      console.log('User.js post error: ', err);\n    } else if (user) {\n      res.json({\n        error: \"Sorry, already a user with the username: \".concat(username)\n      });\n    } else {\n      const newUser = new User({\n        username: username,\n        password: password\n      });\n      newUser.save((err, savedUser) => {\n        if (err) return res.json(err);\n        res.json(savedUser);\n      });\n    }\n  });\n});\nrouter.post('/login', function (req, res, next) {\n  console.log('routes/user.js, login, req.body: ');\n  console.log(req.body);\n  next();\n}, passport.authenticate('local'), (req, res) => {\n  console.log('logged in', req.user);\n  var userInfo = {\n    username: req.user.username\n  };\n  res.send(userInfo);\n});\nrouter.get('/', (req, res, next) => {\n  console.log('===== user!!======');\n  console.log(req.user);\n\n  if (req.user) {\n    res.json({\n      user: req.user\n    });\n  } else {\n    res.json({\n      user: null\n    });\n  }\n});\nrouter.post('/logout', (req, res) => {\n  if (req.user) {\n    req.logout();\n    res.send({\n      msg: 'logging out'\n    });\n  } else {\n    res.send({\n      msg: 'no user to log out'\n    });\n  }\n});\nmodule.exports = router;","map":null,"metadata":{},"sourceType":"script"}